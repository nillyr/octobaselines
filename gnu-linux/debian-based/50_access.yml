- id: 1
  name: Sudo
  checkpoints:
  - id: 1
    title: Installation du paquet sudo
    description: >
      FIXME
    collect_only: false
    checks:
    - id: 1
      title: Le paquet sudo est installé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; dpkg -s sudo 2>/dev/null | grep -Eq "Status:\sinstall\sok\sinstalled" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.7.2.2
    - id: 2
      title: Le paquet sudo-ldap est installé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; dpkg -s sudo-ldap 2>/dev/null | grep -Eq "Status:\sinstall\sok\sinstalled" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.7.2.2
  - id: 2
    title: Configuration des sudoers
    description: >
      FIXME
    collection_cmd: >
      cat /etc/group > etc_group.txt;
      cat /etc/sudoers > sudoers.txt;
      find /etc/sudoers.d/ -type f -exec ls -ailL {} \; -exec cat {} \; > sudoers_custom.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Un groupe habilité à utiliser la commande sudo est spécifié
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^[^#]*sudo[^:]*:[^:]*:[^:]*:.+$" /etc/group && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.57
    - id: 2
      title: Aucun utilisateur en dehors du groupe ne peut utiliser la commande sudo
      description: >
        Aucun utilisateur n'est directement spécifié dans le fichier /etc/sudoers (à l'exception du compte root).
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(grep -E "^[^%#rootDefaults].*\s+\S+(\(\S+\))?\s*" /etc/sudoers /etc/sudoers.d/*) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.57
    - id: 3
      title: Configuration des directives générales - noexec
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^Defaults\s+([^#]+\S+,\s*)*noexec" /etc/sudoers && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.58
    - id: 4
      title: Configuration des directives générales - requiretty
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^Defaults\s+([^#]+\S+,\s*)*requiretty" /etc/sudoers && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.58
    - id: 5
      title: Configuration des directives générales - use_pty
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^Defaults\s+([^#]+\S+,\s*)*use_pty" /etc/sudoers && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.58
    - id: 6
      title: Configuration des directives générales - umask
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^Defaults\s+([^#]+\S+,\s*)*umask=0027" /etc/sudoers && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.58
    - id: 7
      title: Configuration des directives générales - ignore_dot
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^Defaults\s+([^#]+\S+,\s*)*ignore_dot" /etc/sudoers && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.58
    - id: 8
      title: Configuration des directives générales - env_reset
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^Defaults\s+([^#]+\S+,\s*)*env_reset" /etc/sudoers && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.58
    - id: 9
      title: Configuration des directives générales - passwd_timeout
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^Defaults\s+([^#]+\S+,\s*)*passwd_timeout=1" /etc/sudoers && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.58
    - id: 10
      title: Le mot-clé NOPASSWD n'est pas utilisé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(grep -E "^[^#].*\s+\S+(\(\S+\))?\s*NOPASSWD" /etc/sudoers /etc/sudoers.d/*) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.59
    - id: 11
      title: Les spécifications de commandes ne doivent pas faire intervenir de négation
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(grep -E "^[^#].*\s+\S+(\(\S+\))?\s*\!\S+" /etc/sudoers /etc/sudoers.d/*) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.62
    - id: 12
      title: Le caractère * (wildcard) n'est pas utilisé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(grep -E "^[^#].*\s+\S+(\(\S+\))?\s*\*\S*" /etc/sudoers /etc/sudoers.d/*) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.63
- id: 2
  name: Permissions
  checkpoints:
  - id: 1
    title: Permissions sur les fichiers ou dossiers système
    description: >
      FIXME
    collection_cmd: >
      umask > umask.txt;
      stat -c "%A:%u:%g" /boot > boot_stat.txt;
      ls -al /boot > boot_files_perm.txt;
      [ -e /boot/grub2/grub.cfg ] && GRUB_CONFIG_FILE=/boot/grub2/grub.cfg || GRUB_CONFIG_FILE=/boot/grub/grub.cfg; stat -c "%A:%u:%g" "${GRUB_CONFIG_FILE}" > grub_conf_file_perm.txt;
      find /lib /usr/lib /lib64 ! -user root -type d -exec stat -c "%n %U" '{}' \; > system_lib_not_owned_by_root.txt;
      find /lib /usr/lib /lib64 ! -group root -type f -exec stat -c "%n %G" '{}' \; > system_lib_not_owned_by_group_root.txt;
      find /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin ! -user root -type d -exec stat -c "%n %U" '{}' \; > system_cmds_not_owned_by_root.txt;
      find /lib /lib64 /usr/lib -perm /022 -type d -exec stat -c "%n %a" '{}' \; > system_lib_too_much_permisive.txt;
      find /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -perm /022 -type d -exec stat -c "%n %a" '{}' \; > system_cmds_dir_too_much_permisive.txt;
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: L'accès au dossier /boot est uniquement autorisé pour l'utilisateur root
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /boot | grep -Eq "drwx(r|-)-(x|-)(r|-)-(x|-):0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.13
    - id: 2
      title: Les permissions d'accès au fichier de configuration du bootloader sont correctes
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [ -e /boot/grub2/grub.cfg ] && GRUB_CONFIG_FILE=/boot/grub2/grub.cfg || GRUB_CONFIG_FILE=/boot/grub/grub.cfg; stat -c "%A:%u:%g" "${GRUB_CONFIG_FILE}" | grep -Eq "^-r--------:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 3
      title: Les dossiers de libraries du système sont possédés par l'utilisateur root
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(find /lib /usr/lib /lib64 ! -user root -type d -exec stat -c "%n %U" '{}' \;) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        FIXME
    - id: 4
      title: Les fichiers de libraries du système sont possédés par le groupe root
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(find /lib /usr/lib /lib64 ! -group root -type f -exec stat -c "%n %G" '{}' \;) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        FIXME
    - id: 5
      title: Les dossiers contenant des commandes système sont détenus par l'utilisateur root
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(find /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin ! -user root -type d -exec stat -c "%n %U" '{}' \;) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        FIXME
    - id: 6
      title: Les dossiers contenant des librairies système doivent avoir les permissions au plus à 0755
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(find /lib /lib64 /usr/lib -perm /022 -type d -exec stat -c "%n %a" '{}' \;) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        FIXME
    - id: 7
      title: Les dossiers contenant des commandes système doivent avoir les permissions au plus à 0755
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(find /bin /sbin /usr/bin /usr/sbin /usr/local/bin /usr/local/sbin -perm /022 -type d -exec stat -c "%n %a" '{}' \;) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        FIXME
  - id: 2
    title: Permissions sur les fichiers ou dossiers utilisateur
    description: >
      FIXME
    collection_cmd: >
      awk -F: '$7 !~ /nologin|false/ {print $7}' /etc/passwd | sort | uniq | xargs -I{} stat -c "%n %A:%u:%g" {} > shells.txt;
      stat -c "%n %A:%u:%g" /etc/passwd /etc/passwd- /etc/group /etc/group- /etc/shadow /etc/shadow- /etc/gshadow /etc/gshadow- > sensitive_files_perm.txt;
      find / -xdev -type f -perm -0002 > world_writable.txt;
      find / -xdev \( -nouser -o -nogroup \) > nouser_o_nogroup.txt;
      ls /etc/profile.d/ | xargs -I{} stat -c "%n %A:%u:%g" /etc/profile.d/{} > profile_d_perm.txt;
      umask > umask.txt;
      cat /etc/login.defs > etc_login_defs.txt;
      grep -E "^(UMASK|umask)\s+0..\s*(\s*#.*)?$" /etc/login.defs /etc/profile /etc/profile.d/*.sh /etc/bash.bashrc /etc/csh.cshrc /etc/csh.login /etc/zshrc > user_umask.txt;
      grep -E "^(UMASK|umask)\s+0..\s*(\s*#.*)?$" /root/.profile /root/.bashrc /root/.zshrc > root_umask.txt;
      cat /etc/adduser.conf > etc_adduser_conf.txt;
      l_min=$(grep -E "^UID_MIN" /etc/login.defs); l_max=$(grep -E "^UID_MAX" /etc/login.defs); awk -F':' -v "min=${l_min##UID_MIN}" -v "max=${l_max##UID_MAX}" '{ if ($3 >= min && $3 <= max && $7 !~ /nologin|false/) print $6 }' /etc/passwd | xargs -I {} stat -c "%n %A %U %G" {} > home_dir_perm.txt;
      l_min=$(grep -E "^UID_MIN" /etc/login.defs); l_max=$(grep -E "^UID_MAX" /etc/login.defs); awk -F':' -v "min=${l_min##UID_MIN}" -v "max=${l_max##UID_MAX}" '{ if ($3 >= min && $3 <= max && $7 !~ /nologin|false/) print $6 }' /etc/passwd | xargs -I {} ls -laFR {} > user_files.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Les permissions sur les shells sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: 'PASSING=0; awk -F: "$7 !~ /nologin|false/ {print $7}" /etc/passwd | sort | uniq | xargs -I{} stat -c "%A:%u:%g" {} | grep -E "^-rwx(r|-)-x(r|-)-x:0:0" 1>/dev/null && PASSING=1; echo $PASSING'
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        FIXME
    - id: 2
      title: Les permissions du fichier /etc/passwd sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/passwd | grep -Eq "^-rw-(r|-)--(r|-)--:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 3
      title: Les permissions du fichier /etc/passwd- sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/passwd- | grep -Eq "^-rw-(r|-)--(r|-)--:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 4
      title: Les permissions du fichier /etc/group sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/group | grep -Eq "^-rw-(r|-)--(r|-)--:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 5
      title: Les permissions du fichier /etc/group- sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/group- | grep -Eq "^-rw-(r|-)--(r|-)--:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 6
      title: Les permissions du fichier /etc/shadow sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "gid_shadow=$(awk -F: '$1==\"shadow\" {print $3}' /etc/group); PASSING=0; stat -c \"%A:%u:%g\" /etc/shadow | grep -Eq \"^-rw-(r|-)-----:0:(0|${gid_shadow})\" && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 7
      title: Les permissions du fichier /etc/shadow- sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "gid_shadow=$(awk -F: '$1==\"shadow\" {print $3}' /etc/group); PASSING=0; stat -c \"%A:%u:%g\" /etc/shadow- | grep -Eq \"^-rw-(r|-)-----:0:(0|${gid_shadow})\" && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 8
      title: Les permissions du fichier /etc/gshadow sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "gid_shadow=$(awk -F: '$1==\"shadow\" {print $3}' /etc/group); PASSING=0; stat -c \"%A:%u:%g\" /etc/gshadow | grep -Eq \"^-rw-(r|-)-----:0:(0|${gid_shadow})\" && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 9
      title: Les permissions du fichier /etc/gshadow- sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "gid_shadow=$(awk -F: '$1==\"shadow\" {print $3}' /etc/group); PASSING=0; stat -c \"%A:%u:%g\" /etc/gshadow- | grep -Eq \"^-rw-(r|-)-----:0:(0|${gid_shadow})\" && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 10
      title: Aucun fichier ou dossier n'est orphelin
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(find / -xdev \( -nouser -o -nogroup \)) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.5.4
    - id: 11
      title: Aucun fichier n'est modifiable par tout le monde
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; [[ -z $(find / -xdev -type f -perm -0002) ]] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.5.5
    - id: 12
      title: Les permissions sur les scripts profile sont correctement positionnées
      description: >
        FIXME
        Fichiers pouvant contenir la variable d'environnement TMOUT
      type: CMD_EXEC
      cmd: PASSING=0; ls /etc/profile.d/ | xargs -I{} stat -c "%A:%u:%g" /etc/profile.d/{} | grep -E "^-rw-(r|-)--(r|-)--:0:0" 1>/dev/null && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.29
    - id: 13
      title: La valeur du masque des utilisateurs est renforcée
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^(UMASK|umask)\s+077\s*(\s*#.*)?$" /etc/login.defs /etc/profile /etc/profile.d/*.sh /etc/bash.bashrc /etc/csh.cshrc /etc/csh.login /etc/zshrc && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: reinforced
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.35
    - id: 14
      title: La valeur du masque de l'utilisateur root est renforcée
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^(UMASK|umask)\s+077\s*(\s*#.*)?$" /root/.profile /root/.bashrc /root/.zshrc && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: reinforced
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.35
    - id: 15
      title: Le mode de permission des dossiers personnels est renforcé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "DIR_MODE=07[0-5]0\s*(\s*#.*)?$" /etc/adduser.conf && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: reinforced
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
  - id: 3
    title: Permissions sur les tâches planifiées
    description: >
      FIXME
    collection_cmd: >
      ls -l /etc/ | grep cron > etc_cron.txt;
      cat /etc/crontab > etc_crontab.txt;
      find /etc/cron.* -type f -exec ls -ailL {} \; -exec cat {} \; > cron_files.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Les permissions du fichier /etc/crontab sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/crontab | grep -Eq "^-rw-------:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 2
      title: Les permissions du dossier /etc/cron.daily sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/cron.daily | grep -Eq "^drwx------:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 3
      title: Les permissions du dossier /etc/cron.hourly sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/cron.hourly | grep -Eq "^drwx------:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 4
      title: Les permissions du dossier /etc/cron.weekly sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/cron.weekly | grep -Eq "^drwx------:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 5
      title: Les permissions du dossier /etc/cron.monthly sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/cron.monthly | grep -Eq "^drwx------:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
    - id: 6
      title: Les permissions du dossier /etc/cron.d sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; stat -c "%A:%u:%g" /etc/cron.d | grep -Eq "^drwx------:0:0" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.36
  - id: 4
    title: Permissions sur les journaux et outils de journalisation
    description: >
      FIXME
    collection_cmd: >
      find /var/log -exec ls -ail {} \; -exec getfacl {} \; > var_log_acls.txt;
      stat -c "%n %A - %u:%g - %U:%G" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/audispd /sbin/augenrules > audit_tools_acls.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Les permissions du dossier /var/log sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "gid_syslog=$(awk -F: '$1==\"syslog\" {print $3}' /etc/group); PASSING=0; stat -c \"%A:%u:%g\" /var/log | grep -Eq \"^drwx(r|-)-(x|-)---:0:${gid_syslog}\" && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.7.1
        https://www.ssi.gouv.fr/administration/guide/recommandations-de-securite-pour-la-mise-en-oeuvre-dun-systeme-de-journalisation/
    - id: 2
      title: Les permissions du fichier /var/log/syslog sont correctement positionnées
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "uid_syslog=$(awk -F: '$1==\"syslog\" {print $3}' /etc/passwd); gid_adm=$(awk -F: '$1==\"adm\" {print $3}' /etc/group); PASSING=0; stat -c \"%A:%u:%g\" /var/log | grep -Eq \"^-rw-(r|-)-----:${uid_syslog}:${gid_adm}\" && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.7.1
        https://www.ssi.gouv.fr/administration/guide/recommandations-de-securite-pour-la-mise-en-oeuvre-dun-systeme-de-journalisation/
    - id: 3
      title: Les outils de journalisation appartiennent à l'utilisateur root
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [[ -z $(stat -c \"%n %U\" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/audispd /sbin/augenrules | awk -F ' ' '$2!=\"root\" {print $1\" \"$2}') ]] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.7.1
        https://www.ssi.gouv.fr/administration/guide/recommandations-de-securite-pour-la-mise-en-oeuvre-dun-systeme-de-journalisation/
    - id: 4
      title: Les outils de journalisation appartiennent au groupe root
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [[ -z $(stat -c \"%n %G\" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/audispd /sbin/augenrules | awk -F ' ' '$2!=\"root\" {print $1\" \"$2}') ]] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.7.1
        https://www.ssi.gouv.fr/administration/guide/recommandations-de-securite-pour-la-mise-en-oeuvre-dun-systeme-de-journalisation/
    - id: 5
      title: Les permissions d'écriture ne sont pas possitionnées sur les outils de journalisation pour le groupe
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [[ -z $(stat -c \"%A\" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/audispd /sbin/augenrules | cut -c6 | awk '$1!=\"-\" {print $1}') ]] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.7.1
        https://www.ssi.gouv.fr/administration/guide/recommandations-de-securite-pour-la-mise-en-oeuvre-dun-systeme-de-journalisation/
    - id: 6
      title: Les permissions d'écriture ne sont pas possitionnées sur les outils de journalisation pour les autres
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [[ -z $(stat -c \"%A\" /sbin/auditctl /sbin/aureport /sbin/ausearch /sbin/autrace /sbin/auditd /sbin/audispd /sbin/augenrules | cut -c9 | awk '$1!=\"-\" {print $1}') ]] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.7.1
        https://www.ssi.gouv.fr/administration/guide/recommandations-de-securite-pour-la-mise-en-oeuvre-dun-systeme-de-journalisation/
- id: 3
  name: Exécutables avec bits setuid et setgid
  checkpoints:
  - id: 1
    title: Exécutables avec bits setuid et setgid
    description: >
      FIXME
      Voir aussi :
      * https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.37
      * https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.38
    collection_cmd: >
      find / -type f -perm /6000 -ls > setuid_setgid.txt
    collection_cmd_type: CMD_EXEC
    collect_only: true
