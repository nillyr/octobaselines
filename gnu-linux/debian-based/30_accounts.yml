- id: 1
  name: Stockage des identifiants
  checkpoints:
  - id: 1
    title: Stockage des identifiants - PAM
    description: >
      FIXME
    collect_only: false
    checks:
    - id: 1
      title: L'algorithme de hashage est sécurisé
      description: >
        PAM et /etc/login.defs peuvent être configurés afin d'utiliser SHA-512 et un nombre de tours assez grand.
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_unix\.so\s+(\S+\s+)*(sha256|sha512)\s*(\S+\s*)*$" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.32
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
    - id: 2
      title: Nombre de tours assez grand
      description: >
        PAM et /etc/login.defs peuvent être configurés afin d'utiliser SHA-512 et un nombre de tours assez grand.
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_unix\.so\s+(\S+\s+)*rounds=65536\s*(\S+\s*)*$" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.32
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
  - id: 2
    title: Stockage des identifiants - login.defs
    description: >
      FIXME
    collection_cmd: >
      cat /etc/login.defs > login_defs.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: L'algorithme de hashage est sécurisé
      description: >
        PAM et /etc/login.defs peuvent être configurés afin d'utiliser SHA-512 et un nombre de tours assez grand.
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^ENCRYPT_METHOD\s*(SHA256|SHA512)\s*$" /etc/login.defs && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.32
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
    - id: 2
      title: Nombre de tours assez grand
      description: >
        PAM et /etc/login.defs peuvent être configurés afin d'utiliser SHA-512 et un nombre de tours assez grand.
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^SHA_CRYPT_MIN_ROUNDS\s*65536\s*$" /etc/login.defs && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.32
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
  - id: 3
    title: Stockage des identifiants - /etc/passwd
    description: >
      FIXME
    collection_cmd: >
      cat /etc/passwd > etc_passwd.txt;
      cat /etc/shadow > etc_shadow.txt;
      cat /etc/login.defs > login_defs.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Aucun mot de passe n'est stocké en clair
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [ -z $(awk -F: '{ if ($2 !~ x) print $2 }' /etc/passwd) ] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        FIXME
- id: 2
  name: Pluggable Authentication Module - PAM
  checkpoints:
  - id: 1
    title: Politique de mots de passe
    description: >
      FIXME
    collection_cmd: >
      find /etc/pam.d/ -type f -exec ls -ailL {} \; -exec cat {} \; > pam_all_config.txt;
      find /etc/security/ -type f -name *.conf -exec ls -ailL {} \; -exec cat {} \; > pam_security_conf.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Longueur d'au moins 10 caractères
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_pwquality\.so\s+(\S+\s+)+minlen=[1-9][0-9]{1,}" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 2
      title: Présence d'au moins un caractère minuscule
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_pwquality\.so\s+(\S+\s+)+lcredit=-[1-9]" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 3
      title: Présence d'au moins un caractère majuscule
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_pwquality\.so\s+(\S+\s+)+ucredit=-[1-9]" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 4
      title: Présence d'au moins un caractère spécial
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_pwquality\.so\s+(\S+\s+)+ocredit=-[1-9]" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 5
      title: Présence d'au moins un nombre
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_pwquality\.so\s+(\S+\s+)+dcredit=-[1-9]" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 6
      title: Vérification depuis un dictionnaire
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_pwquality\.so\s+(\S+\s+)+dictpath=" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 7
      title: Politique applicable depuis l'utilisateur root
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)+pam_pwquality\.so\s+(\S+\s+)+enforce_for_root" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 8
      title: Vérouillage temporaire des comptes - attaque par force brute
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^(auth|account)\s+(\S+\s+)*pam_tally2\.so" /etc/pam.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwquality
    - id: 9
      title: Utilisation d'un historique de mots de passe d'au moins 5 mots de passe
      description: >
        L'utilisation d'un historique de mots de passe permet de garantir la non-réutilisation des mots de passe au cours du temps.
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)*pam_(pwhistory|unix)\.so\s+(\S+\s+)*remember=([5-9]|[1-9][0-9]{1,})" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
        https://linux.die.net/man/8/pam_pwhistory
        https://linux.die.net/man/8/pam_unix
  - id: 2
    title: Restriction d'accès au compte root via la commande su
    description: >
      FIXME
    collect_only: false
    checks:
    - id: 1
      title: L'utilisation de la commande su est restreinte aux utilisateurs du groupe wheel
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^auth\s+(\S+\s+)+pam_wheel\.so\s*(\S+\s+)*(\s+#.*)?$" /etc/pam.d/su && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
  - id: 3
    title: Désactivation de l'accès root via tout périphérique (tty)
    description: >
      FIXME
    collection_cmd: >
      cat /etc/securetty > securetty.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Le module pam_securetty est utilisé
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^auth\s+(\S+\s+)*pam_securetty\.so\s*(\S+\s+)*(\s+#.*)?$" /etc/pam.d/login && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
    - id: 2
      title: Le fichier securetty existe
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; [ -f /etc/securetty ] && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
    - id: 3
      title: Le fichier securetty est vide
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: wc -l /etc/securetty | awk -F ' ' '{print $1}'
      expected: 0
      verification_type: CHECK_EXACT
      severity: high
      level: elevated
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
- id: 3
  name: Lightweight Directory Access Protocol - LDAP
  checkpoints:
  - id: 1
    title: Name Service Switch - NSS
    description: >
      FIXME
    collection_cmd: >
      cat /etc/nsswitch.conf > nsswitch_conf.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Utilisation de LDAP pour la base de données locale passwd
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^passwd:\s+(\S+\s+)*(ldap|sss)(\s+\S+)*(\s+#.*)?$" /etc/nsswitch.conf && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.2
        https://linux.die.net/man/5/nsswitch.conf
    - id: 2
      title: Utilisation de LDAP pour la base de données locale group
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^group:\s+(\S+\s+)*(ldap|sss)(\s+\S+)*(\s+#.*)?$" /etc/nsswitch.conf && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.2
        https://linux.die.net/man/5/nsswitch.conf
    - id: 3
      title: Utilisation de LDAP pour la base de données locale shadow
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^shadow:\s+(\S+\s+)*(ldap|sss)(\s+\S+)*(\s+#.*)?$" /etc/nsswitch.conf && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.2
        https://linux.die.net/man/5/nsswitch.conf
  - id: 2
    title: Pluggable Authentication Module - PAM
    description: >
      FIXME
    collection_cmd: >
      find /etc/pam.d/ -type f -exec ls -ailL {} \; -exec cat {} \; > pam_all_config.txt;
      cat /etc/ldap/ldap.conf > ldap_conf.txt;
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: L'authentification est effectuée au travers de LDAP
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^auth\s+(\S+\s+)*pam_ldap\.so" /etc/pam.d/common-auth && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/ldap.conf
    - id: 2
      title: La gestion du compte est effectuée au travers de LDAP
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^account\s+(\S+\s+)*pam_ldap\.so" /etc/pam.d/common-account && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/ldap.conf
    - id: 3
      title: La gestion de la session est effectuée au travers de LDAP
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^session\s+(\S+\s+)*pam_ldap\.so" /etc/pam.d/common-session && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/ldap.conf
    - id: 4
      title: La gestion du mot de passe est effectuée au travers de LDAP
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^password\s+(\S+\s+)*pam_ldap\.so" /etc/pam.d/common-password && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/ldap.conf
    - id: 5
      title: Un répertoire personnel est mis à disposition de chaque utilisateur
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^session\s+(\S+\s+)*pam_mkhomedir\.so" /etc/pam.d/common-session && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/ldap.conf
    - id: 6
      title: Le masque du répertoire personnel est permet de restreindre l'accès aux données
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^session\s+(\S+\s+)*pam_mkhomedir\.so\s+(\S+\s+)*umask=(0027|0077)" /etc/pam.d/common-session && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: reinforced
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.35
        https://linux.die.net/man/5/ldap.conf
    - id: 7
      title: Une couche de chiffrement SSL/TLS est utilisée
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^TLS_CACERT\s+\S+\s*$" /etc/ldap/ldap.conf && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.31
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.33
        https://linux.die.net/man/5/ldap.conf
        https://www.openldap.org/faq/data/cache/185.html
    - id: 8
      title: La couche de chiffrement SSL/TLS est constamment utilisée
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=1; grep -Eq "^TLS_REQCERT\s+(never|allow|try)(\s+#.*)?$" /etc/ldap/ldap.conf && PASSING=0; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.31
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.33
        https://linux.die.net/man/5/ldap.conf
        https://www.openldap.org/faq/data/cache/185.html
  - id: 3
    title: System Security Services Daemon - SSSD
    description: >
      FIXME
    collection_cmd: >
      cat /etc/sssd/sssd.conf > sssd_conf.txt;
      find /etc/sssd/conf.d/ -type f -exec ls -ailL {} \; -exec cat {} \; > sssd_d_conf.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Le paquet sssd est installé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; dpkg -s sssd 2>/dev/null | grep -Eq "Status:\sinstall\sok\sinstalled" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/sssd.conf
        https://linux.die.net/man/5/sssd-ldap
    - id: 2
      title: L'authentification est réalisée via LDAP
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^\s*ldap_uri\s+=\s+ldap" /etc/sssd/sssd.conf /etc/sssd/conf.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/sssd.conf
        https://linux.die.net/man/5/sssd-ldap
    - id: 3
      title: La mise en cache est activée
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^\s*cache_credentials\s+=\s+true" /etc/sssd/sssd.conf /etc/sssd/conf.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/sssd.conf
        https://linux.die.net/man/5/sssd-ldap
    - id: 4
      title: La mise en cache est limitée à 1 jour
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^\s*offline_credentials_expiration\s+=\s+1" /etc/sssd/sssd.conf /etc/sssd/conf.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: low
      level: reinforced
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/sssd.conf
        https://linux.die.net/man/5/sssd-ldap
    - id: 5
      title: Une couche de chiffrement SSL/TLS est utilisée - cacert
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^\s*ldap_tls_cacert\s+=\s+\S+\s*(\s+#.*)?$" /etc/sssd/sssd.conf /etc/sssd/conf.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.31
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.33
        https://linux.die.net/man/5/sssd.conf
        https://linux.die.net/man/5/sssd-ldap
    - id: 6
      title: Une couche de chiffrement SSL/TLS est utilisée - reqcert
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=1; grep -Eq "^\s*ldap_tls_reqcert\s+=\s+(never|allow|try)\s*(\s+#.*)?$" /etc/sssd/sssd.conf /etc/sssd/conf.d/* && PASSING=0; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.31
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.33
        https://linux.die.net/man/5/sssd.conf
        https://linux.die.net/man/5/sssd-ldap
  - id: 4
    title: Name Service Caching Daemon - NSCD
    description: >
      FIXME
    collection_cmd: >
      cat /etc/nscd.conf > nscd_conf.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Le paquet nscd est installé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; dpkg -s nscd 2>/dev/null | grep -Eq "Status:\sinstall\sok\sinstalled" && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/nslcd.conf
    - id: 2
      title: L'authentification est réalisée via LDAP
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^\s*uri\s+.*(\s+#.*)$" /etc/nscd.conf && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: info
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://linux.die.net/man/5/nslcd.conf
    - id: 3
      title: Une couche de chiffrement SSL/TLS est utilisée - ssl
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^\s*ssl\s+(on|start_tls)\s*(\s+#.*)?$" /etc/nscd.conf && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.31
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.33
        https://linux.die.net/man/5/nslcd.conf
    - id: 4
      title: Une couche de chiffrement SSL/TLS est utilisée - reqcert
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=1; grep -Eq "^\s*tls_reqcert\s+=\s+(never|allow|try)\s*(\s+#.*)?$" /etc/nscd.conf && PASSING=0; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.31
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.33
        https://linux.die.net/man/5/nslcd.conf
- id: 4
  name: Gestion des comptes d'accès
  checkpoints:
  - id: 1
    title: Utilisateurs
    description: >
      FIXME
    collection_cmd: >
      cat /etc/passwd > etc_passwd.txt;
      cat /etc/shadow > etc_shadow.txt;
      l_min=$(grep -E "^UID_MIN" /etc/login.defs); l_max=$(grep -E "^UID_MAX" /etc/login.defs); awk -F':' -v "min=${l_min##UID_MIN}" -v "max=${l_max##UID_MAX}" '{ if ($3 >= min && $3 <= max && $7 !~ /nologin|false/) print $0 }' /etc/passwd > normal_users_accounts.txt;
      l_min=$(grep -E "^UID_MIN" /etc/login.defs); l_max=$(grep -E "^UID_MAX" /etc/login.defs); awk -F':' -v "min=${l_min##UID_MIN}" -v "max=${l_max##UID_MAX}" '{ if ( !($3 >= min && $3 <= max && $7 !~ /nologin|false/)) print $0 }' /etc/passwd > system_user_accounts.txt;
      l_min=$(grep -E "^UID_MIN" /etc/login.defs); awk -F':' -v "min=${l_min##UID_MIN}" '{ if ($3 >= min && $7 !~ /nologin|false/) print $1 }' /etc/passwd | xargs -I {} last -R {} > last_logins.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: La création d'un mot de passe vide n'est pas possible
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^[^#](\S+\s*)*nullok" /etc/pam.d/* || PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
    - id: 2
      title: Tous les utilisateurs ont un mot de passe
      description: >
        FIXME_DESCRIPTION
      type: CMD_EXEC
      cmd: "PASSING=0; [ -z $(awk -F: '!$2 {print $1}' /etc/shadow) ] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://www.ssi.gouv.fr/guide/recommandations-relatives-a-lauthentification-multifacteur-et-aux-mots-de-passe/
    - id: 3
      title: Chaque UID est unique
      description: >
        FIXME pas de duplicate dans les UIDs
      type: CMD_EXEC
      cmd: "PASSING=0; [ -z $(awk -F: 'list[$3]++{print $1, $3}' /etc/passwd) ] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
    - id: 4
      title: Chaque nom d'utilisateur est unique
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [ -z $(cut -d: -f1 /etc/passwd | sort | uniq -d) ] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
    - id: 5
      title: Un seul compte dispose des droits superutilisateur (root)
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [ $(awk -F: '($3 == 0) {print $1}' /etc/passwd | wc -l) -eq 1 ] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
    - id: 6
      title: Chaque utilisateur dispose d'un dossier personnel
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=1; awk -F: '{ if ($1 !~ /halt|sync|shutdown/ && $7 !~ /nologin|false/) print $6}' /etc/passwd | xargs -I {} [ -d {} ] || PASSING=0; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
    - id: 7
      title: Les comptes système sont désactivés
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; l_min=$(grep -E \"^UID_MIN\" /etc/login.defs); [ -z $(awk -F: -v \"min=${l_min##UID_MIN}\" '($1 !~ /root|sync|shutdown|halt/ && $1 !~ /^\\+/ && $3 < min && $7 !~ /nologin|false/) {print}' /etc/passwd) ] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: medium
      level: intermediate
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.26
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.27
    - id: 8
      title: L'accès au compte root est désactivé
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [ -z $(awk -F: '{if ($1==\"root\" && $7 ~ \"nologin\") { print $1 $7 } }' /etc/passwd) ] && PASSING=1; echo $PASSING"
      expected: 0
      verification_type: CHECK_EXACT
      severity: high
      level: elevated
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#subsection.6.4.1
        https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-controlling_root_access
  - id: 2
    title: Groupes
    description: >
      FIXME
    collection_cmd: >
      cat /etc/group > group.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Chaque GID est unique
      description: >
        FIXME pas de duplicate dans les GIDs
      type: CMD_EXEC
      cmd: "PASSING=0; [[ -z $(awk -F: '$4 !~ /65534/ && list[$4]++{print $1, $4}' /etc/passwd) ]] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
    - id: 2
      title: Chaque nom de groupe est unique
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=0; [ -z $(cut -d: -f1 /etc/group | sort | uniq -d) ] && PASSING=1; echo $PASSING"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
    - id: 3
      title: Aucun utilisateur n'est présent dans le groupe shadow
      description: >
        FIXME
      type: CMD_EXEC
      cmd: 'PASSING=0; [ -z $(grep -E "^shadow:[^:]*:[^:]*:[^:]+" /etc/group) ] && PASSING=1; echo $PASSING'
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
    - id: 4
      title: Tout les groupes déclarés dans /etc/passwd sont existants dans /etc/group
      description: >
        FIXME
      type: CMD_EXEC
      cmd: "PASSING=$(awk -F: '{print $4}' /etc/passwd | xargs -I {} sh -c 'grep -Eq \"^.*?:[^:]*:{}:\" /etc/group || echo 0' | uniq); { [[ $PASSING == \"0\" ]] && echo 0 || echo 1; }"
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: minimal
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section.6.3
  - id: 3
    title: Sessions
    description: >
      FIXME
    collection_cmd: >
      cat /etc/bash.bashrc;
      find /etc/profile.d/ -type f -exec ls -ailL {} \; -exec cat {} \; > etc_profile_scripts.txt
    collection_cmd_type: CMD_EXEC
    collect_only: false
    checks:
    - id: 1
      title: Un délai d'expiration de sessions utilisateurs est défini
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^TMOUT=[1-9][0-9]{1,}" /etc/bash.bashrc /etc/profile.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: reinforced
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.29
    - id: 2
      title: Un délai d'expiration de sessions utilisateurs ne peut pas être modifié par un utilisateur
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^readonly\s+TMOUT" /etc/bash.bashrc /etc/profile.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: reinforced
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.29
    - id: 3
      title: Un délai d'expiration de sessions utilisateurs est ajouté à l'environnement des utilisateurs
      description: >
        FIXME
      type: CMD_EXEC
      cmd: PASSING=0; grep -Eq "^export\s+TMOUT" /etc/bash.bashrc /etc/profile.d/* && PASSING=1; echo $PASSING
      expected: 1
      verification_type: CHECK_EXACT
      severity: high
      level: reinforced
      recommendation_on_failed: >
        FIXME_RECO
      see_also: >
        https://www.ssi.gouv.fr/uploads/2016/01/linux_configuration-fr-v1.2.pdf#section*.29
